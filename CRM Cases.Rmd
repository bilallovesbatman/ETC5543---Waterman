---
title: "Customer Retention - CRM Cases"
author: "Bilal Raja"
date: "2024-08-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries

```{r}
library(tidyverse)
library(readxl)
```

## Load Data

```{r, warning=FALSE}
wmcases <- read_xlsx("data/CRM Cases 1-08-2024 5-17-55 PM.xlsx")
memberships <- read_xlsx("data/Office and Membership subscriptions 1-08-2024 4-52-20 PM.xlsx")
accounts <- read_xlsx("data/CRM Company Accounts 1-08-2024 4-36-46 PM.xlsx")
```

```{r}
glimpse(wmcases) 
```
```{r}
glimpse(memberships)
```
```{r}
glimpse(accounts)
```

## Wrangle data

```{r}
cases_clean <- wmcases |>
  filter(!grepl("Product delivery", Subject, ignore.case = TRUE) &
           !grepl("ETC waiver", Subject, ignore.case = TRUE) &
           !grepl("Financial request", Subject, ignore.case = TRUE) &
           !grepl("Purchase orders", Subject, ignore.case = TRUE) &
           !grepl("Rent/Membership assistance", Subject, ignore.case = TRUE) &
           !grepl("All retired ones", Subject, ignore.case = TRUE) &
           !grepl("\\(RETIRED\\)", Subject, ignore.case = TRUE)) |>
  select(-`(Do Not Modify) Case`,
         -`(Do Not Modify) Row Checksum`,
         -`(Do Not Modify) Modified On`)
```

```{r}
cases_clean |>
  filter(is.na(`Account Number (Customer) (Account)`))
```


```{r}
glimpse(cases_cleaned)
```

```{r}
member_clean <- memberships |>
  filter(!grepl("Quote Duplicate", `Status Reason`, ignore.case = TRUE)) |>
  select(-`(Do Not Modify) Primary Product`,
         -`(Do Not Modify) Row Checksum`,
         -`(Do Not Modify) Modified On`)
```

```{r}
glimpse(member_clean)
```
```{r}
accounts_clean <- accounts |>
  filter(!grepl("1a - Pre-billing", `Status Reason`, ignore.case = TRUE))|>
  select(-`(Do Not Modify) Account`, 
         -`(Do Not Modify) Row Checksum`, 
         -`(Do Not Modify) Modified On`)
```

